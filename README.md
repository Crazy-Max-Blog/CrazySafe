# CrazySafe

Проект для конкурса "РобоФинист 2025", программа "39. Партнерские соревнования MGBOT: Интернет вещей. Умная банковская система Младшая категория".

## Код

Проект сделан в PlatformIO в Visual Studio Code.
Можно запустить симуляцию через дополнение Wokwi для VS Code. Для этого необходимо для начала скомпилироваать проект. 
В файле `settings.h` находятся настройки: WiFi, Telegram Bot, а также пин, ширина и высота матрицы.

### Структура кода

Код находится в папке `src`.

* `main.cpp` - основной файл проекта
* `settings.h` - файл с настройками проекта
* `connect_wifi.h` - часть кода для подключения к WiFi
* `tg.h` - часть кода для работы с Telegram Bot
* `safe.h` - часть кода для симуляции сейфа
* `course.h` - часть кода для получения курса валют
* `display.h` - часть кода для работы с LED матрицей
* `CrazyMatrix.h` - библиотека для работы с LED матрицей
* `dec2places.h` - библиотека для работы с числами с двумя знаками после запятой

## Схемотехника

В качестве контролера используется MgBot Iotik32B. К нему подключается матрица на адресных светодиодах WS2812.

## Преимущества проекта

Информация о балансе доступна в трёх валютах: рублях, долларах и евро.
Курс валют парсится с сайта и обновляется раз в 10 минут.

В качестве типа данных для хранения баланса используется "самодельный 64-битный тип данных" - подробнее описано в коментариях внутри файла `dec2places.h`.
Самый большой тип данных с запятой в C++ ESP32 - long double, занимает 8 байт, но из-за особеностей (подробнее в `dec2places.h`) самое большое число с двумя знаками после запятой ~ 45 триллионов, а это в ~ 40 раз меньше, чем у нас.

## Описание работы устройства

Устройство подключается к WiFi, в это время на матрице есть соответствующие знаки.
После подключения к WiFi на матрице запускается бегущая строка, информируящая значение баланса в трёх валютах.
В Telegram Bot в первый раз необходимо отправить команду `/start`, после чего бот отправит приветствие и кратко расскажет о себе.
После етого в Telegram появится клавиатура-меню с кнопками "Пополнить", "Снять", "Снять всё" и "Узнать баланс".
Действия с управлением балансом работают в рублях, баланс отображается во всех трёх валютах.

## Лицензия

В качестве лицензии на исходный код используется GNU Affero General Public License v3.0.